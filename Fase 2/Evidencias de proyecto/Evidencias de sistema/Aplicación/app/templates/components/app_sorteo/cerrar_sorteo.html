{% extends "base.html" %}

{% block content %}
    <h1>Cerrar Sorteo</h1>
    
    <!-- Mostrar el sorteo actual si existe -->
    {% if sorteo %}
        <h2>Producto: {{ sorteo.producto.nombre }}</h2>
        <p>Puntos requeridos: {{ sorteo.producto.puntos_requeridos }}</p>
        <p>Stock disponible: {{ sorteo.producto.stock }}</p>
        <p>Participantes: {{ participaciones.count }}</p>

        <!-- Listar los participantes -->
        <h3>Participantes</h3>
        <ul>
            {% for participacion in participaciones %}
                <li>{{ participacion.empleado.usuario.get_full_name }} - {{ participacion.fecha_participacion }}</li>
            {% empty %}
                <li>No hay participantes en este sorteo.</li>
            {% endfor %}
        </ul>

        <!-- BotÃ³n para cerrar el sorteo -->
        {% if participaciones %}
            <form method="post" action="{% url 'cerrar_sorteo' sorteo.producto.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">Cerrar Sorteo y Seleccionar Ganador</button>
            </form>
        {% else %}
            <p>No se puede cerrar el sorteo porque no hay participaciones.</p>
        {% endif %}
    {% else %}
        <p>No hay sorteos activos para cerrar en este momento.</p>
    {% endif %}

{% endblock %}
